<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday</title>
    <link rel="stylesheet" href="css/img.css">
    <style>
        .music-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .music-btn:hover {
            background: #fff;
            color: #2fc6c8;
        }
        .music-btn.playing::after {
            content: "üéµ";
            font-size: 20px;
            animation: rotate 2s linear infinite;
        }
        .music-btn.paused::after {
            content: "‚è∏";
            font-size: 20px;
        }
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>

<body>
<audio id="bgMusic" src="music/chunfengchui.mp3" autoplay="autoplay" loop="loop" preload="auto"></audio>
<div id="musicBtn" class="music-btn playing"></div>
<div class="container">
    <ul class="img-ul">
        <li class="img-li"><img src="img/img1.jpg" alt=""></li>
        <li class="img-li"><img src="img/img2.jpg" alt=""></li>
        <li class="img-li"><img src="img/img3.jpg" alt=""></li>
        <li class="img-li"><img src="img/img4.jpg" alt=""></li>
        <li class="img-li"><img src="img/img5.jpg" alt=""></li>
        <li class="img-li"><img src="img/img6.jpg" alt=""></li>
        <li class="img-li"><img src="img/img7.jpg" alt=""></li>
        <li class="img-li"><img src="img/img8.jpg" alt=""></li>
    </ul>
</div>
<div class="htmleaf-container">
    <div class="wrapper">
        <ul class="bg-bubbles">
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
    </div>
</div>

<script src="js/jquery-3.6.0.min.js"></script>
<script>
    // Èü≥‰πêÊéßÂà∂ - Á°Æ‰øùÂú®img.js‰πãÂâçÊâßË°å
    window.isPlaying = true; // ÂÖ®Â±ÄÂèòÈáè‰ª•‰æøÂÖ∂‰ªñËÑöÊú¨ËÆøÈóÆ
    $(function() {
        const music = document.getElementById('bgMusic');
        const musicBtn = document.getElementById('musicBtn');

        // Â∞ùËØïËá™Âä®Êí≠Êîæ
        function tryAutoPlay() {
            let playPromise = music.play();
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    // Ëá™Âä®Êí≠ÊîæÊàêÂäü
                    window.isPlaying = true;
                    musicBtn.className = 'music-btn playing';
                }).catch(error => {
                    // ÊµèËßàÂô®ÈòªÊ≠¢‰∫ÜËá™Âä®Êí≠Êîæ
                    console.log("ÊµèËßàÂô®ÈòªÊ≠¢‰∫ÜËá™Âä®Êí≠Êîæ");
                    window.isPlaying = false;
                    musicBtn.className = 'music-btn paused';
                });
            }
        }

        // ÁõëÂê¨È°µÈù¢ÂèØËßÅÊÄßÂèòÂåñ
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'visible') {
                // È°µÈù¢Âèò‰∏∫ÂèØËßÅÊó∂ÔºåÂ¶ÇÊûú‰πãÂâçÊòØÊí≠ÊîæÁä∂ÊÄÅÔºåÂ∞±ÈáçÊñ∞Êí≠Êîæ
                if (window.isPlaying) {
                    tryAutoPlay();
                }
            }
        });

        // ÁõëÂê¨È°µÈù¢ÈáçÊñ∞Ëé∑ÂæóÁÑ¶ÁÇπ
        window.addEventListener('focus', function() {
            if (window.isPlaying) {
                tryAutoPlay();
            }
        });

        // ÂàùÂßãËá™Âä®Êí≠Êîæ
        tryAutoPlay();

        // ÁõëÂê¨Èü≥‰πêÊí≠ÊîæÁä∂ÊÄÅ
        music.addEventListener('playing', function() {
            window.isPlaying = true;
            musicBtn.className = 'music-btn playing';
        });

        music.addEventListener('pause', function() {
            window.isPlaying = false;
            musicBtn.className = 'music-btn paused';
        });

        // Èü≥‰πêÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
        musicBtn.addEventListener('click', function(e) {
            e.stopPropagation(); // ÈòªÊ≠¢‰∫ã‰ª∂ÂÜíÊ≥°
            if (window.isPlaying) {
                music.pause();
            } else {
                music.play().then(() => {
                    window.isPlaying = true;
                    musicBtn.className = 'music-btn playing';
                }).catch(error => {
                    console.log("Êí≠ÊîæÂ§±Ë¥•", error);
                });
            }
        });
    });
</script>
<script src="js/img.js"></script>
</body>
</html>